<?php class Justselling_Configurator_Block_Loading extends Mage_Core_Block_Template{const PACKAGE_NAME = "\160\162o\x64\x75\143\164c\157\x6ef\151\x67u\x72\x61\x74or";const MODULE_NAME = "\x4a\165\163\164s\x65\154\x6c\151\156\147\x5f\x43\157nf\151\x67urat\157\x72";const PRODUCT_ID = "\063";const API_USER = 'license';const API_KEY = 'ru474r784trefugfu';const MODE_PRODUCTION = 'production';const MODE_DEVELOPMENT = 'development'; const SECURE_URL_HASH_KEY = 'aHR0cDovL3d3dy5wcm9kdWN0LWNvbmZpZ3VyYXRvci5iaXovYXBpL2luY2hvby9qc29u'; private $x0b = "";private $x0c = "";private $x0d = "";private $x0e = NULL;private $x0f = NULL;private $x10 = NULL;protected function _toHtml(){$x11 = parent::_toHtml();try {$x12 = $this->checkLicense();} catch (Exception $x13) {$x12 = false;}if (!$x12) {$x14 = $this->getNoLicenseJsHtml();$x11 = $x14 . $x11;}return $x11;}public function checkLicense(){$x15 = $this->getMageSecureUrlHashKey();$x16 =Mage::getStoreConfig(self::PACKAGE_NAME .'/general/licensekey');if (!$x16) {return 0;}$x17 = $this->getMageDomains(); $x18 = md5($x16) ;foreach ($x17 as $x19) {$x1a = gethostbyname($x19);$x18 .=md5($x19).sha1($x1a);}$this->activationString = $x18 . sha1(substr($x15, 4, 11)); $this->activationDir = $this->getActivationDir();$this->activationFile = $this->getActivationFile();if (file_exists($this->activationFile)) {$x1b = "";$x1c = fopen($this->activationFile, "r");if ($x1c) {$x1b = fgets($x1c);fclose($x1c);}if ($x1b == md5("P") .$this->activationString) {Mage::getSingleton('core/session')->setEdition("\x50");return 1;} elseif ($x1b == md5("U") .$this->activationString) {Mage::getSingleton('core/session')->setEdition("\x55");return 1;} else {if ($x1b == md5("\102") .$this->activationString) { Mage::getSingleton('core/session')->setEdition("\102");return 1;} else { $x1d = $this->httpJsonCheck($x16);return $x1d;}}} $x1d = $this->httpJsonCheck($x16);return $x1d;}private function getNoLicenseJsHtml(){$x1e = "N\x6f\x20va\x6c\x69\x64\040\154\x69\143en\163\x65\040\x6be\x79\040fo\x72\040\x6d\141\x67\x65\156\x74\x6f\x20e\170t\145\x6e\x73\x69\x6f\x6e:\x20<s\164\x72\x6fn\x67\076" . self::MODULE_NAME . '</strong>.<br/>Get one on <a style="color:black" href="http://www.product-configurator.biz/">www.product-configurator.biz</a>.';$x1f = '"text-align: center; background: red; position: absolute; top: 0; bottom: 0; width: 100%; height: 20px; padding: 20px;z-index:99999;"';$x20 = "v\x61r\x20\x64\x69v \075 '\x3cd\x69v\040\x73tyle=" . $x1f . ">" . $x1e . "\074/di\166\x3e'\x3b";$x14 = "<\163\143\162\x69\x70\164 \164\x79p\145\x3d'\x74\x65x\x74\057\152\141\x76\x61\x73\143r\151\160\164'\x3e". $x20. "$$\050'\142o\144y'\051\x5b\x30\135\x2e\x69\x6es\x65\162t\050\144\151\166\x29\x3b\x0d
\040\x20\x20\x20\x20\040\040\x20\x20\040 \x20\040  \x20\x20 \040  \x20\040</s\143\162\151p\164\076";return $x14;}private function getActivationDir(){return Mage::getBaseDir('var') . "\x2f\x6a\163\x6c\x69cen\x73\x65";}private function getActivationFile(){return $this->getActivationDir() . "\057" . self::PACKAGE_NAME . "\056\164\170t";}private function getMagePackageName(){return self::PACKAGE_NAME;}private function getMagePackageVersion(){$x21 = self::MODULE_NAME;return (string)Mage::getConfig()->getNode()->modules->$x21->version;}private function getMageSecureUrlHashKey(){return base64_decode(self::SECURE_URL_HASH_KEY);}private function getMageVersion(){$x22 = Mage::getVersionInfo();$x23 = $x22['major']."\056".$x22['minor'].".".$x22['revision']."\056".$x22['patch'];return $x23;}private function getMageLocale(){$x24 = explode('_', Mage::app()->getLocale()->getLocale());return strtolower($x24[0]);}private function getMageEditionName(){if ($this->isMageProfessionalEdition())return 'professional';if ($this->isMageEnterpriseEdition())return 'enterprise';if ($this->isMageCommunityEdition())return 'community';if ($this->isMageGoEdition())return 'magento go';return 'undefined';}private function isMageGoEdition(){return class_exists('Saas_Db', false);}private function isMageProfessionalEdition(){if ($this->isMageGoEdition())return false;if (in_array('Professional_License', $this->getMageModules()))return true;return false;}private function isMageEnterpriseEdition(){if ($this->isMageGoEdition())return false;if (in_array('Enterprise_License', $this->getMageModules()))return true;return false;}private function isMageCommunityEdition(){if ($this->isMageGoEdition() || $this->isMageProfessionalEdition() || $this->isMageEnterpriseEdition())return false;return true;}private function getMageDbTables(){return Mage::getSingleton('core/resource')->getConnection('core_read')->listTables();}private function getMageDbTablesPrefix(){return ( string )Mage::getConfig()->getTablePrefix();}private function getMageDbVersion(){return Mage::getSingleton('core/resource')->getConnection('core_read')->getServerVersion();}private function getMageDbApiName(){$x25 = Mage::getSingleton('core/resource')->getConnection('core_read')->getConnection();return $x25 instanceof PDO ? $x25->getAttribute(PDO::ATTR_CLIENT_VERSION) : 'N/A';}private function getMageDbSettings(){$x26 = "S\x48\117\127\x20\126\x41\x52\111\x41\102\114\x45S\x20\x57H\x45\x52\x45\x20\x60\x56\141\x72iab\x6c\x65\137\156\141\x6de` \111N\x20\050'\x63\x6fn\x6e\145c\x74_\x74\151m\x65o\x75\x74'\054'\x77a\x69t\137\x74\x69meo\x75\x74')";$x27 = Mage::getSingleton('core/resource')->getConnection('core_read')->fetchAll($x26);$x28 = array();foreach ($x27 as $x29) {$x28 [$x29 ['Variable_name']] = $x29 ['Value'];}return $x28;}private function getMageDbName(){return ( string )Mage::getConfig()->getNode('global/resources/default_setup/connection/dbname');}private function getMageModules(){return array_keys(( array )Mage::getConfig()->getNode('modules')->children());}private function getMageBaseCurrency(){return ( string )Mage::getStoreConfig(Mage_Directory_Model_Currency::XML_PATH_CURRENCY_BASE);}private function getMageDefaultWebsite(){if (is_null($this->defaultWebsite)) {$this->defaultWebsite = Mage::getModel('core/website')->load(1, 'is_default');if (is_null($this->defaultWebsite->getId())) {$this->defaultWebsite = Mage::getModel('core/website')->load(0);if (is_null($this->defaultWebsite->getId())) {throw new Exception ('Failed: Getting default website');}}}return $this->defaultWebsite;}private function getMageDomains(){$x2a = array();foreach (Mage::getModel('core/store')->getCollection() as $x2b) {$x2c =Mage::app()->getStore($x2b->getId())->getBaseUrl(Mage_Core_Model_Store::URL_TYPE_LINK);$x2c = preg_replace("\057\150t\x74\x70:\057\x2f/", "", $x2c);$x2c = preg_replace("/\x68\164t\160\x73:/\x2f/", "", $x2c);$x2c = preg_replace("\057\057.*$\057", "", $x2c);$x2a [] = $x2c;}$x2a = array_unique($x2a);return $x2a;}private function getMageDomainsUnique(){return sizeof(array_unique($this->getMageDomains()));}private function getMageDefaultWebsiteId(){return ( int )$this->getMageDefaultWebsite()->getId();}private function getMageDefaultStoreGroup(){if (is_null($this->defaultStoreGroup)) {$x0e = $this->getMageDefaultWebsite();$x2d = $x0e->getMageDefaultGroupId();$this->defaultStoreGroup = Mage::getModel('core/store_group')->load($x2d);if (is_null($this->defaultStoreGroup->getId())) {$this->defaultStoreGroup = Mage::getModel('core/store_group')->load(0);if (is_null($this->defaultStoreGroup->getId())) {throw new Exception ('Failed: Getting default store group');}}}return $this->defaultStoreGroup;}private function getMageDefaultStoreGroupId(){return ( int )$this->getMageDefaultStoreGroup()->getId();}private function getMageDefaultStore(){if (is_null($this->defaultStore)) {$x0f = $this->getMageDefaultStoreGroup();$x2e = $x0f->getMageDefaultStoreId();$this->defaultStore = Mage::getModel('core/store')->load($x2e);if (is_null($this->defaultStore->getId())) {$this->defaultStore = Mage::getModel('core/store')->load(0);if (is_null($this->defaultStore->getId())) {throw new Exception ('Failed: Getting default store');}}}return $this->defaultStore;}private function getMageDefaultStoreId(){return ( int )$this->getMageDefaultStore()->getId();}private function isMageSingleStoreMode(){return Mage::getModel('core/store')->getCollection()->getSize() <= 2;}private function isMageMultiStoreMode(){return !$this->isMageSingleStoreMode();}private function getMageHost(){$x19 = $this->getMageDomain();return $x19 == '' ? $this->getIp() : $x19;}private function getMageDomain(){$x2f = isset ($_SERVER ['HTTP_HOST']) ? $_SERVER ['HTTP_HOST'] : NULL;if (!is_null($x2f)) {strpos($x2f, 'www.') === 0 && $x2f = substr($x2f, 4);return strtolower(trim($x2f));}return "\165\x6e\x64e\x66i\156\x65d";}private function getMageIp(){$x30 = isset ($_SERVER ['SERVER_ADDR']) ? $_SERVER ['SERVER_ADDR'] : NULL;is_null($x30) && $x30 = isset ($_SERVER ['LOCAL_ADDR']) ? $_SERVER ['LOCAL_ADDR'] : NULL;if (!is_null($x30)) {return strtolower(trim($x30));}return "\061\062\067\0560.0.\x31";}private function isMageDeveloperMode(){return ( bool )Mage::getIsDeveloperMode();}private function getMageOs(){return php_uname();}private function getMagePhpVersion(){return @phpversion();}private function getMagePhpApiName(){return @php_sapi_name();}private function getMagePhpSettings(){return array('memory_limit' => $this->getMageMemoryLimit(),'max_execution_time' => @ini_get('max_execution_time'));}private function getMageMemoryLimit($x31 = true){$x32 = trim(ini_get('memory_limit'));if ($x32 == '') {return 0;}$x33 = strtolower(substr($x32, -1));switch ($x33) {case 'g' :$x32 *= 1024;case 'm' :$x32 *= 1024;case 'k' :$x32 *= 1024;}if ($x31) {$x32 /= 1024 * 1024;}return $x32;}private function getMageRequest($x34 = NULL){$x35 = array('mode' => $this->isMageDeveloperMode() ? self::MODE_DEVELOPMENT : self::MODE_PRODUCTION,'client' => array('platform' => array('edition' => $this->getMageEditionName(),'version' => $this->getMageVersion(),'os' => $this->getMageOs(),'multi' => $this->isMageMultiStoreMode(),'domains' => $this->getMageDomains(),'unique' => $this->getMageDomainsUnique()),'module' => array('name' => $this->getMagePackageName(),'version' => $this->getMagePackageVersion()),'php' => array('version' => $this->getMagePhpVersion(),'settings' => $this->getMagePhpSettings()),'location' => array('domain' => $this->getMageDomain(),'ip' => $this->getMageIp(),'base' => str_replace('index.php/', '', Mage::getBaseUrl())),'db' => array('name' => $this->getMageDbName(),'version' => $this->getMageDbVersion(),'prefix' => $this->getMageDbTablesPrefix(),'settings' => $this->getMageDbSettings()),'locale' => array('locale' => $this->getMageLocale(),'currency' => $this->getMageBaseCurrency())),'auth' => array(),'command' => $x34);return $x35;}private function httpJsonCheck($x36 = NULL){$x37 = "";$x38 = array('jsonrpc' => '2.0','method' => 'login','params' => array(self::API_USER,self::API_KEY),'id' => time());$x39 = curl_init($this->getMageSecureUrlHashKey());$x3a = json_encode($x38);curl_setopt($x39, CURLOPT_CUSTOMREQUEST, "\120\x4fS\124"); curl_setopt($x39, CURLOPT_POSTFIELDS, $x3a);curl_setopt($x39, CURLOPT_RETURNTRANSFER, true);curl_setopt($x39, CURLOPT_HTTPHEADER, array('Content-Type: application/json','Content-Length: ' . strlen($x3a)) ); $x2c = json_decode(curl_exec($x39));if ($x2c)$x37 = $x2c->result;if ($x37) {$x38 = array('jsonrpc' => '2.0','method' => 'call','params' => array($x37,'justselling.activatelicensev2',array('licensekey' => sprintf("%\x30\0604\x73", self::PRODUCT_ID) . '-' .$x36,'params' => $this->getMageRequest())),'id' => time());$x3a = json_encode($x38);curl_setopt($x39, CURLOPT_POSTFIELDS, $x3a);curl_setopt($x39, CURLOPT_HTTPHEADER, array( 'Content-Type: application/json', 'Content-Length: ' . strlen($x3a)) );$x2c = json_decode(curl_exec($x39)); $x3b = $x2c->result;if ($x3b->status) {$x3c = $x3b->edition;if ($x3c == '2') {$x3c = 'P';Mage::getSingleton('core/session')->setEdition("\120");Mage::getModel('core/config')->saveConfig('productconfigurator/general/edition', "\x50\x72\157\146ess\x69o\156\x65\x6c\x20".Mage::helper("\x63o\x6e\146\x69\147\x75r\141\x74o\162")->getConfiguratorVersion());Mage::app()->getCacheInstance()->cleanType("con\146\151g")->clean();} elseif ($x3c == '3') {$x3c = 'U';Mage::getSingleton('core/session')->setEdition("\125");Mage::getModel('core/config')->saveConfig('productconfigurator/general/edition', "\x55\154ti\155\x61\164e\040".Mage::helper("c\x6fnfi\147\x75\162a\x74\x6fr")->getConfiguratorVersion() );Mage::app()->getCacheInstance()->cleanType("\x63\157\156\146\x69g")->clean();} else {$x3c = 'B';Mage::getSingleton('core/session')->setEdition("\102");Mage::getModel('core/config')->saveConfig('productconfigurator/general/edition', "\102\141\x73i\x63\x20".Mage::helper("\143\x6f\156\146\151\x67\165rat\x6fr")->getConfiguratorVersion() );Mage::app()->getCacheInstance()->cleanType("\x63o\156\146\x69\147")->clean();}$x18 = md5($x3c) . $this->activationString;if (!file_exists($this->activationDir)) {mkdir($this->activationDir, 0777);}$x1c = fopen($this->activationFile, "w");if (!$x1c) {Mage::getModel('core/config')->saveConfig('productconfigurator/general/edition', "\125\156\x61\x62\x6ce\040\164\157\x20\167\162i\x74\145\040\141\x63tiv\x61\x74i\157n\x20f\x69\154\145,\040c\150\145c\x6b \160e\x72\x6d\151s\163\x69\157\x6e\x73\x21");Mage::app()->getCacheInstance()->cleanType("\143\157n\146i\x67")->clean();Mage::throwException($this->__('Unable to write activation file, check permissions!'));return 0;} else {Mage::Log("\141\x63t\151v\x61t\151\157\x6e\x3a " . $x18);fwrite($x1c, $x18);fclose($x1c);return "\157\153\040" . var_export($x2c, true);}} else {$x3b = $x2c->result;$x3d = $x3b->message;Mage::getModel('core/config')->saveConfig('productconfigurator/general/edition', "\x41c\164i\166at\151\x6f\156\040\x66ai\x6ce\144: ".$x3d);Mage::app()->getCacheInstance()->cleanType("\143\157\156f\151\x67")->clean();Mage::throwException($this->__('Product configurator activation problem 02: ' . var_export($x2c, true)));return 0;}}}}